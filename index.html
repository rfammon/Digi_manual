<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-R">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual de Poda e Corte Interativo - Guia R√°pido</title>
    
    <link rel="stylesheet" href="style.css?v=22.2"> <link rel="stylesheet" href="libs/leaflet.css" />
</head>
<body>

    <header class="header-manual" id="page-top">
        <h1>Manual Interativo de Poda e Corte</h1>
        <p>Seu guia de bolso para conceitos, t√©cnicas e seguran√ßa.</p>
    </header>

    <main>
        
        <div id="app-content">
            <section class="mapa-navegacao">
                <h2>Mapa Interativo do Manual</h2>
                
                <nav class="topicos-container">
                    <button class="topico-btn active" data-target="conceitos-basicos">üí° Defini√ß√µes e Termos</button>
                    <button class="topico-btn" data-target="planejamento-inspecao">üìã Planejamento e Risco</button>
                    <button class="topico-btn" data-target="autorizacao-legal">üìú Termos Legais (ASV)</button>
                    <button class="topico-btn" data-target="preparacao-e-isolamento">üöß Prepara√ß√£o (Isolamento)</button>
                    <button class="topico-btn" data-target="operacoes-e-tecnicas">‚úÇÔ∏è Poda e Supress√£o</button>
                    <button class="topico-btn" data-target="riscos-e-epis">üõ°Ô∏è EPIs e An√°lise de Risco</button>
                    <button class="topico-btn" data-target="gestao-e-desmobilizacao">‚ôªÔ∏è Res√≠duos (MTR)</button>
                    <button class="topico-btn" data-target="glossario-geral">üìò Gloss√°rio Geral</button>
                    <button class="topico-btn" data-target="sobre-autor">üë®‚Äçüíª Sobre o Autor</button>
                    <button class="topico-btn" data-target="calculadora-risco">üìä Calculadora de Risco</button>
                </nav>
            </section>

            <section class="conteudo-detalhe" id="manual-view">
                <div id="detalhe-view">
                    </div>
            </section>

            <section class="app-view conteudo-detalhe" id="calculadora-view" style="display: none;">
                
                <h3>üìä Calculadora de Risco Arb√≥reo</h3>
                <p>Use o mapa para visualiza√ß√£o geoespacial do risco, a aba "Registrar" para coleta e "Resumo" para gerenciar os dados.</p>
                
                <nav class="sub-nav">
                    <button type="button" class="sub-nav-btn" data-target="tab-content-register">
                        Registrar √Årvore
                    </button>
                    <button type="button" class="sub-nav-btn" data-target="tab-content-summary">
                        Resumo da Vistoria <span id="summary-badge" class="badge"></span>
                    </button>
                    <button type="button" class="sub-nav-btn" data-target="tab-content-mapa">
                        Mapa GIS üó∫Ô∏è
                    </button>
                </nav>

                <div id="tab-content-register" class="sub-tab-content">
                    <form id="risk-calculator-form">
                        <fieldset class="risk-fieldset">
                            <legend>1. Identifica√ß√£o da √Årvore</legend>
                            <div class="form-grid">
                                <div>
                                    <label for="risk-data">Data da Coleta:</label>
                                    <input type="date" id="risk-data" name="risk-data">
                                </div>
                                <div>
                                    <label for="risk-especie">Esp√©cie (Nome/Tag):</label>
                                    <input type="text" id="risk-especie" name="risk-especie" required>
                                </div>
                                <div>
                                    <label for="risk-local">Local (Endere√ßo/Setor):</label>
                                    <input type="text" id="risk-local" name="risk-local">
                                </div>
                                <div>
                                    <label for="risk-coord-x">Coord. X (UTM ou Lon):</label>
                                    <input type="text" id="risk-coord-x" name="risk-coord-x">
                                </div>
                                <div>
                                    <label for="risk-coord-y">Coord. Y (UTM ou Lat):</label>
                                    <input type="text" id="risk-coord-y" name="risk-coord-y">
                                </div>
                                <div class="gps-button-container">
                                    <button type="button" id="get-gps-btn">üõ∞Ô∏è Capturar GPS</button>
                                    <span id="gps-status"></span>
                                </div>
                                <div>
                                    <label for="risk-dap">DAP (cm):</label>
                                    <input type="number" id="risk-dap" name="risk-dap" min="0" step="any">
                                </div>
                                <div>
                                    <label for="risk-avaliador">Avaliador:</label>
                                    <input type="text" id="risk-avaliador" name="risk-avaliador">
                                </div>
                            </div>
                            <div>
                                <label for="risk-obs">Observa√ß√µes (Opcional):</label>
                                <textarea id="risk-obs" name="risk-obs" rows="3" placeholder="Ex: Cavidade no tronco, presen√ßa de pragas, galho sobre telhado..."></textarea>
                            </div>

                            <div class="photo-upload-container">
                                <label for="tree-photo-input" class="photo-btn">üì∑ Adicionar Foto</label>
                                <input type="file" id="tree-photo-input" accept="image/*" capture="environment" style="display: none;">
                                
                                <div id="photo-preview-container">
                                    <button type="button" id="remove-photo-btn" style="display:none;">&times;</button>
                                </div>
                            </div>
                            
                        </fieldset>
                        
                        <fieldset class="risk-fieldset">
                            <legend>2. Lista de Verifica√ß√£o de Risco</legend>
                            <table class="risk-table">
                                <thead>
                                    <tr><th>N¬∫</th><th>Pergunta</th><th>Peso</th><th>Sim</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>1</td><td>H√° galhos mortos com di√¢metro superior a 5 cm?</td><td>3</td><td><input type="checkbox" class="risk-checkbox" data-weight="3"></td></tr>
                                    <tr><td>2</td><td>Existem rachaduras ou fendas no tronco ou galhos principais?</td><td>5</td><td><input type="checkbox" class="risk-checkbox" data-weight="5"></td></tr>
                                    <tr><td>3</td><td>H√° sinais de apodrecimento (madeira esponjosa, fungos, cavidades)?</td><td>5</td><td><input type="checkbox" class="risk-checkbox" data-weight="5"></td></tr>
                                    <tr><td>4</td><td>A √°rvore possui uni√µes em ‚ÄúV‚Äù com casca inclusa?</td><td>4</td><td><input type="checkbox" class="risk-checkbox" data-weight="4"></td></tr>
                                    <tr><td>5</td><td>H√° galhos cruzados ou friccionando entre si?</td><td>2</td><td><input type="checkbox" class="risk-checkbox" data-weight="2"></td></tr>
                                    <tr><td>6</td><td>A √°rvore apresenta copa assim√©trica (>30% de desequil√≠brio)?</td><td>2</td><td><input type="checkbox" class="risk-checkbox" data-weight="2"></td></tr>
                                    <tr><td>7</td><td>H√° sinais de inclina√ß√£o anormal ou recente?</td><td>5</td><td><input type="checkbox" class="risk-checkbox" data-weight="5"></td></tr>
                                    <tr><td>8</td><td>A √°rvore est√° pr√≥xima a vias p√∫blicas ou √°reas de circula√ß√£o?</td><td>5</td><td><input type="checkbox" class="risk-checkbox" data-weight="5"></td></tr>
                                    <tr><td>9</td><td>H√° risco de queda sobre edifica√ß√µes, ve√≠culos ou pessoas?</td><td>5</td><td><input type="checkbox" class="risk-checkbox" data-weight="5"></td></tr>
                                    <tr><td>10</td><td>A √°rvore interfere em redes el√©tricas ou estruturas urbanas?</td><td>4</td><td><input type="checkbox" class="risk-checkbox" data-weight="4"></td></tr>
                                    <tr><td>11</td><td>A esp√©cie √© conhecida por apresentar alta taxa de falhas?</td><td>3</td><td><input type="checkbox" class="risk-checkbox" data-weight="3"></td></tr>
                                    <tr><td>12</td><td>A √°rvore j√° sofreu podas dr√°sticas ou brota√ß√£o epic√≥rmica intensa?</td><td>3</td><td><input type="checkbox" class="risk-checkbox" data-weight="3"></td></tr>
                                    <tr><td>13</td><td>H√° cal√ßadas rachadas ou tubula√ß√µes expostas pr√≥ximas √† base?</td><td>3</td><td><input type="checkbox" class="risk-checkbox" data-weight="3"></td></tr>
                                    <tr><td>14</td><td>H√° perda vis√≠vel de ra√≠zes de sustenta√ß√£o (>40%)?</td><td>5</td><td><input type="checkbox" class="risk-checkbox" data-weight="5"></td></tr>
                                    <tr><td>15</td><td>H√° sinais de compacta√ß√£o ou asfixia radicular?</td><td>3</td><td><input type="checkbox" class="risk-checkbox" data-weight="3"></td></tr>
                                    <tr><td>16</td><td>H√° apodrecimento em ra√≠zes prim√°rias (>3 cm)?</td><td>5</td><td><input type="checkbox" class="risk-checkbox" data-weight="5"></td></tr>
                                </tbody>
                            </table>
                            <div class="mobile-checklist-wrapper">
                                <div class="mobile-checklist-card"></div>
                                <div class="mobile-checklist-nav">
                                    <button type="button" id="checklist-prev">‚ùÆ Anterior</button>
                                    <span class="checklist-counter">1 / 16</span>
                                    <button type="button" id="checklist-next">Pr√≥xima ‚ùØ</button>
                                </div>
                            </div>
                        </fieldset>
                        
                        <div class="risk-buttons-area">
                            <button type="submit" id="add-tree-btn">‚ûï Adicionar √Årvore</button>
                            <button type="button" id="reset-risk-form-btn">Limpar Campos</button>
                        </div>
                    </form>
                </div>
                
                <div id="tab-content-summary" class="sub-tab-content">
                    <fieldset class="risk-fieldset">
                        <legend>3. √Årvores Cadastradas</legend>
                        
                        <div class="table-filter-container">
                            <input type="text" id="table-filter-input" placeholder="üîé Filtrar por ID, esp√©cie, local, risco...">
                        </div>
                        
                        <div id="summary-table-container">
                            <p id="summary-placeholder">Nenhuma √°rvore cadastrada ainda.</p>
                        </div>
                        
                        <div id="import-export-controls" class="risk-buttons-area">
                            
                            <input type="file" id="zip-importer" accept=".zip,application/zip,application/x-zip-compressed" style="display: none;">
                            <input type="file" id="csv-importer" accept="text/csv,application/csv,application/vnd.ms-excel,.csv,text/plain" style="display: none;">
                            
                            <button type="button" id="import-data-btn" class="export-btn zip-import-label">üì§ Importar Dados</button>
                            <button type="button" id="export-data-btn" class="export-btn">üì• Exportar Dados</button>
                            
                            <button type="button" id="send-email-btn" class="export-btn">üìß Enviar por Email</button>
                            <button type="button" id="clear-all-btn" class="export-btn">üóëÔ∏è Limpar Tabela</button>
                        </div>
                        
                        <div id="zip-status" style="display: none;">
                            <span class="spinner" style="display: inline-block;"></span>
                            <span id="zip-status-text" style="margin-left: 10px; font-weight: bold; color: #004d40;">Processando pacote...</span>
                        </div>

                    </fieldset>
                </div>
                
                <div id="tab-content-mapa" class="sub-tab-content mapa-tab">
                    <fieldset class="risk-fieldset">
                        <legend>Mapa de Localiza√ß√£o e Risco</legend>
                        
                        <div id="map-legend-filter">
                            <h4>Legenda / Filtro</h4>
                            <div class="legend-filter-grid">
                                <div class="legend-filter">
                                    <input type="radio" id="filter-todos" name="risk-filter" value="Todos" checked>
                                    <label for="filter-todos">Todos</label>
                                </div>
                                <div class="legend-filter">
                                    <input type="radio" id="filter-alto" name="risk-filter" value="Alto Risco">
                                    <label for="filter-alto"><span class="legend-dot" style="background-color: #C62828;"></span> Alto Risco</label>
                                </div>
                                <div class="legend-filter">
                                    <input type="radio" id="filter-medio" name="risk-filter" value="M√©dio Risco">
                                    <label for="filter-medio"><span class="legend-dot" style="background-color: #E65100;"></span> M√©dio Risco</label>
                                </div>
                                <div class="legend-filter">
                                    <input type="radio" id="filter-baixo" name="risk-filter" value="Baixo Risco">
                                    <label for="filter-baixo"><span class="legend-dot" style="background-color: #2E7D32;"></span> Baixo Risco</label>
                                </div>
                            </div>
                        </div>

                        <div id="map-info-box" class="hidden"></div>
                        
                        <div id="map-container"></div>
                        
                        <div class="form-grid" style="margin-top: 15px; gap: 10px;">
                            <div>
                                <label for="default-utm-zone">Zona UTM Padr√£o (Ex: 23K):</label>
                                <input type="text" id="default-utm-zone" placeholder="Ex: 23K" style="height: 38px;">
                                <small style="color: #555; font-size: 0.8em;">(Necess√°rio para dados antigos ou importados)</small>
                            </div>
                            <button type="button" id="zoom-to-extent-btn" class="export-btn">üìç Aproximar dos Pontos</button>
                        </div>
                    </fieldset>
                </div>
            </section>
        </div>

        <section id="gemini-chat">
            <h2>ü§ñ Assistente Digital (Baseado no Manual)</h2>
            <div class="chat-container">
                <div id="chat-response-box">
                    <p class="chat-placeholder">Fa√ßa uma pergunta espec√≠fica sobre o manual (ex: "Qual a diferen√ßa entre poda dr√°stica e redu√ß√£o?" ou "Quais EPIs s√£o necess√°rios para motosserra?").</p>
                </div>
                
                <div class="chat-input-area">
                    <input type="text" id="chat-input" placeholder="Digite sua pergunta aqui...">
                    <button id="chat-send-btn">Enviar</button>
                </div>
            </div>
        </section>

        <section id="fale-conosco">
            <h2>üìß D√∫vidas e Sugest√µes</h2>
            <div class="contact-form-container">
                
                <form id="contact-form" class="contact-form">
                    
                    <label for="nome">Seu Nome:</label>
                    <input type="text" id="nome" name="Nome" required placeholder="Seu nome completo">
                    
                    <label for="email">Seu Email (para retorno):</label>
                    <input type="email" id="email" name="Email_de_Retorno" required placeholder="seu.email@exemplo.com.br">
                    
                    <label for="assunto">Assunto:</label>
                    <input type="text" id="assunto" name="Assunto" required placeholder="D√∫vida sobre o manual / Sugest√£o">

                    <label for="mensagem">Sua D√∫vida ou Mensagem:</label>
                    <textarea id="mensagem" name="Mensagem" rows="5" required placeholder="Escreva aqui sua pergunta ou feedback sobre o manual."></textarea>
                    
                    <button type="submit" class="send-btn">Enviar via Cliente de E-mail</button>
                </form>
            </div>
            <p class="contact-note">Aten√ß√£o: Este bot√£o abrir√° seu cliente de e-mail padr√£o (Ex: Outlook, Gmail App).</p>
        </section>

    </main>

    <a href="#page-top" id="back-to-top-btn" title="Voltar ao Topo">&#9650;</a>

    <footer class="footer-manual">
        <p>&copy; 2025 Manual Digital. Desenvolvido com Site Builder.</p>
    </footer>

    <script src="libs/leaflet.js"></script>
    <script src="libs/proj4.js"></script>
    <script src="libs/jszip.min.js"></script>
    
    <div id="toast-notification"></div>

    <div class="modal-overlay" id="action-modal">
        <div class="modal-dialog">
            <h3 id="modal-title">T√≠tulo Padr√£o</h3>
            <p id="modal-description">Descri√ß√£o padr√£o.</p>
            <div class="modal-actions">
                </div>
        </div>
    </div>
    
    <div class="modal-dialog photo-viewer-dialog" id="photo-viewer-dialog" style="display: none; z-index: 1001;">
      <h3 id="photo-viewer-title">Foto da √Årvore</h3>
      <button type="button" class="photo-viewer-close" id="photo-viewer-close" title="Fechar">&times;</button>
      
      <div class="photo-viewer-content" id="photo-viewer-content">
        </div>
    </div>
    
    <script type="module" src="js/main.js?v=23.15"></script>

</body>
</html>
